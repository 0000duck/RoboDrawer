startup_rvc
%% Denavit-Hartenberg Parameters
%         theta    d          a     alpha
DH = [
            0  0.089159       0      pi/2
            0      0       -0.425      0
            0      0      -0.39225     0
            0   0.10915       0      pi/2
            0   0.09465       0     -pi/2
            0    0.0823       0        0
    ];
    
UR5_1 = SerialLink(DH);
UR5_2 = SerialLink(DH);

% default_config = [0 0 0 0 0 0];
v_final = [120 -40 40 0 30 0];
v_final = deg2rad(v_final);
% MTH_final = UR5.fkine(v_final);
% 
%W=0.001*[0,0;-23,47;-44,88;-64,129;-88,166;-115,193;-142,224;-180,244;-224,244;-261,227;-298,203;-322,170;-360,190;-394,210;-427,241;-475,254;-519,261;-553,254;-587,227;-604,193;-611,156;-601,115;-587,88;-574,64;-567,44;-597,54;-628,74;-658,102;-689,112;-723,125;-747,146;-771,173;-801,203;-818,237;-845,268;-859,302;-872,339;-879,387;-883,424;-876,465;-866,499;-849,533;-825,567;-798,587;-781,614;-743,642;-709,662;-686,682;-648,710;-608,727;-563,747;-512,764;-475,774;-434,795;-397,801;-377,811;-363,811;-387,798;-407,764;-411,730;-417,693;-417,645;-400,608;-383,584;-370,560;-346,543;-312,526;-271,526;-234,540;-197,543;-176,560;-142,570;-139,584;-125,597;-122,618;-115,648;-101,672;-101,706;-101,747;-95,791;-98,832;-81,835;-74,805;-71,788;-61,774;-57,744;-40,754;-6,754;7,754;28,747;38,761;48,778;68,795;72,815;79,828;89,791;89,754;85,720;96,682;102,652;113,625;133,591;153,570;181,543;218,523;248,523;289,536;333,553;367,567;388,594;408,631;408,659;408,686;398,706;388,737;388,761;371,788;357,805;374,808;408,801;425,795;466,781;493,771;527,757;564,744;595,716;625,713;656,696;690,682;721,655;741,635;765,608;799,581;826,547;846,519;856,499;877,462;887,414;880,390;880,360;870,336;856,309;843,285;829,254;802,227;778,207;758,180;724,156;697,129;673,102;646,91;615,74;595,54;571,37;558,37;561,54;578,85;592,108;592,139;592,173;581,197;561,227;541,241;507,248;469,244;449,241;418,224;391,210;364,197;344,186;330,176;327,163;306,186;286,210;265,227;242,241;218,241;191,241;164,241;140,231;116,214;106,197;82,176;72,159;58,139;48,115;38,85;24,71;14,40;4,27];
W=0.01*coordinates;
% t = (2:2:size(W));
% q = jtraj(default_config, v_final, t);
% 
% UR5.plot(q);


% path = [ 1 0 1; 1 0 0; 0 0 0; 0 2 0; 1 2 0;
% 1 2 1; 0 1 1; 0 1 0; 1 1 0; 1 1 1];
% plot3(path(:,1), path(:,2), path(:,3), 'color', 'k', 'LineWidth', 2);
% p = mstraj(path, [0.5 0.5 0.3], [], [2 2 2], 0.02, 0.2);
% Tp = transl(0.1 * p);
% Tp = homtrans( transl(0.4, 0, 0), Tp);
full_traj = [];
s = size(W);

figure('Name', 'UR5_MTH');
t = (0:0.01:0.05);
% q_in = [2.094395102393195,-0.698131700797732,0.698131700797732,0,0.523598775598299,0];
% test = transl(W(1,1), -0.567074392606245, W(1,2)) * troty(pi/2);
% q1 = UR5_1.ikunc(test);
% full_traj(1,1) = q1(1);
% full_traj(1,2) = q1(2);
% full_traj(1,3) = q1(3);
% full_traj(1,4) = q1(4);
% full_traj(1,5) = q1(5);
% full_traj(1,6) = q1(6);
% k1 = jtraj(q_in, q1, t);
% UR5_1.plot(k1);
MTH_final = UR5_1.fkine(v_final);

for i = 1:size(W)
    if i == 1
        q_in = UR5_1.ikunc(MTH_final);
        test = transl(0.535736116985854, W(i,1), W(i,2)) * troty(pi/2);
        q1 = UR5_1.ikunc(test);
        full_traj(i,1) = q1(1);
        full_traj(i,2) = q1(2);
        full_traj(i,3) = q1(3);
        full_traj(i,4) = q1(4);
        full_traj(i,5) = q1(5);
        full_traj(i,6) = q1(6);
        k1 = jtraj(q_in, q1, t);
        UR5_1.plot(k1);
    else
        test = transl(0.535736116985854, W(i,1), W(i,2)) * troty(pi/2);
        q1 = UR5_1.ikunc(test);
        full_traj(i,1) = q1(1);
        full_traj(i,2) = q1(2);
        full_traj(i,3) = q1(3);
        full_traj(i,4) = q1(4);
        full_traj(i,5) = q1(5);
        full_traj(i,6) = q1(6);
        prev_point = [full_traj(i-1,1) full_traj(i-1,2) full_traj(i-1,3) full_traj(i-1,4) full_traj(i-1,5) full_traj(i-1,6)]
        k1 = jtraj(prev_point, q1, t)
        plot3(0.535736116985854, W(i,1), W(i,2), '.');
        xlim([-1 1]);
        ylim([-1 1]);
        zlim([-1 1]);
        hold on;
        UR5_1.plot(k1);
    end
end

% get_fk = UR5_1.fkine(v_final);
% q1 = UR5_1.ikunc(get_fk);

% figure('Name', 'UR5_deg');
% q2 = UR5.fkine(v_final);
% q3 = UR5_2.ikunc(q0);
% UR5_2.plot(q3);
